<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>TechShop - Productos</title>
        <meta charset="UTF-8">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
            .header-green {
                background-color: #28a745;
                color: white;
                padding: 20px;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div class="header-green">
            <h2>Su tienda en línea</h2>
        </div>
        
        <div class="container mt-4">
            <a href="/producto/nuevo" class="btn btn-primary mb-3">
                Agregar Producto
            </a>
            
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Descripción</th>
                        <th>Precio</th>
                        <th>Existencias</th>
                        <th>Total</th>
                        <th>Imagen</th>
                        <th>Categoría</th>
                        <th>Activo</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="producto, iterStat : ${productos}">
                        <td th:text="${iterStat.count}">1</td>
                        <td th:text="${producto.descripcion}">Producto</td>
                        <td th:text="${producto.precio}">0</td>
                        <td th:text="${producto.existencias}">0</td>
                        <td th:text="${producto.precio * producto.existencias}">0</td>
                        <td>
                            <img th:src="${producto.rutaImagen}" alt="img" style="max-width:100px">
                        </td>
                        <td th:text="${producto.categoria != null ? producto.categoria.descripcion : 'Sin categoría'}">Categoría</td>
                        <td th:text="${producto.activo ? 'Activa' : 'Inactiva'}">Activa</td>
                        <td>
                            <button type="button" class="btn btn-danger btn-sm" 
                                    data-bs-toggle="modal" 
                                    th:data-bs-target="'#modalEliminar' + ${producto.idProducto}">
                                Eliminar
                            </button>
                            
                            <!-- Modal de confirmación -->
                            <div class="modal fade" th:id="'modalEliminar' + ${producto.idProducto}" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header bg-warning">
                                            <h5 class="modal-title">⚠️ Confirma eliminación</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <p>¿Realmente desea eliminar <strong th:text="${producto.descripcion}"></strong>?</p>
                                            <p class="text-muted">Esta acción no se puede revertir.</p>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <form th:action="@{/producto/eliminar}" method="post" style="display:inline;">
                                                <input type="hidden" name="idProducto" th:value="${producto.idProducto}">
                                                <button type="submit" class="btn btn-danger">Eliminar</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <a th:href="@{'/producto/modificar/' + ${producto.idProducto}}" 
                               class="btn btn-success btn-sm">
                                Actualizar
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>